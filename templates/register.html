<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Register Â· Fitness Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
<header class="site-header">
  <nav class="wrap nav">
    <a href="/" style="font-weight:800">Fitness Tracker</a>
  </nav>
</header>

<main class="wrap">
  <h1>Register</h1>
  <form id="reg-form" class="card" style="max-width:460px">
    <div class="form-item">
      <label>Email</label>
      <input id="reg-email" type="email" required placeholder="you@example.com" />
    </div>
    <div class="form-item">
      <label>Password</label>
      <input id="reg-pass" type="password" required minlength="6" placeholder="minimum 6 characters" />
    </div>
    <div class="form-item">
      <button class="primary" type="submit">Create account</button>
    </div>
    <hr style="border:none;border-top:1px solid #222;margin:12px 0">
    <small class="hint">Already have an account? <a href="/login">Login</a></small>
  </form>
</main>

<script>
async function postJSON(url, body){
  const res = await fetch(url, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify(body),
    credentials:"include"
  });
  if (!res.ok) throw new Error(await res.text());
  return res.json();
}

document.getElementById('reg-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = document.getElementById('reg-email').value.trim();
  const password = document.getElementById('reg-pass').value;
  try {
    await postJSON('/api/auth/register', {email, password});
    await postJSON('/api/auth/login', {email, password}); // auto-login
    location.href = '/';
  } catch(e) {
    alert(e.message || 'Registration failed');
  }
});
</script>
</body>
</html>